<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>ÊµÅÂä®ÊÄßÊ±†Â≠êÂÆûÊó∂Êï∞ÊçÆ</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<link rel="icon" href="mus2s-cn38c-001.ico" type="image/x-icon" />

<!-- ========== Ê†∑Âºè ========== -->
<style>
:root{
  --c-primary:#0078d4;--c-primary-dark:#005fa3;
  --c-bg:#f9f9f9;     --c-card:#fff;
  --c-text:#222;      --c-sub:#555;
  --c-skeleton:#e5e7eb;
  --grad-total:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);
}
html.dark{
  --c-bg:#111827;--c-card:#1f2937;
  --c-text:#f3f4f6;--c-sub:#9ca3af;
  --c-skeleton:#374151;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:"Segoe UI","PingFang SC","Microsoft YaHei",sans-serif;
  background:var(--c-bg);color:var(--c-text);
  padding:28px 16px;display:flex;flex-direction:column;align-items:center;
  transition:background .3s,color .3s;
}
.topbar{width:100%;max-width:680px;display:flex;justify-content:space-between;
  align-items:center;margin-bottom:18px;flex-wrap:wrap;gap:10px}
.title{font-size:24px;font-weight:700;color:var(--c-primary);display:flex;align-items:center;gap:6px}
#spinner{display:none}.spin{display:block;animation:rotate 1s linear infinite}
@keyframes rotate{to{transform:rotate(360deg)}}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.switch{display:flex;align-items:center;gap:4px;font-size:14px;cursor:pointer}
.switch input{accent-color:var(--c-primary);cursor:pointer}
select{padding:6px 10px;border:1px solid #ccc;border-radius:6px;font-size:14px;cursor:pointer}
.btn{display:inline-flex;align-items:center;gap:6px;padding:10px 20px;font-size:15px;
  background:var(--c-primary);color:#fff;border:none;border-radius:8px;
  text-decoration:none;cursor:pointer;transition:.18s background}
.btn:hover{background:var(--c-primary-dark)} .btn:disabled{opacity:.6;cursor:not-allowed}
.btn-icon{width:16px;height:16px;vertical-align:middle}
.cards{width:100%;max-width:680px;display:flex;flex-direction:column;gap:12px}
.row{display:grid;grid-template-columns:auto 1fr auto;align-items:center;background:var(--c-card);
  padding:14px 20px 14px 16px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.05);
  position:relative;overflow:hidden}
.row::before{content:"";position:absolute;left:0;top:0;width:6px;height:100%;background:var(--stripe,#ccc)}
.label{display:flex;align-items:center;gap:10px;font-size:18px;font-weight:600;white-space:nowrap}
.token-icon,.icon-fallback{width:32px;height:32px;border-radius:50%;object-fit:cover}
.icon-fallback{display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
.value{text-align:right;min-width:160px}
.amount-label,.price-label,.ratio-label{display:block;font-size:12px;font-weight:600;color:var(--c-sub)}
.value-num{font-size:18px;font-variant-numeric:tabular-nums}
.value-price{font-size:14px;margin-top:2px;font-variant-numeric:tabular-nums}
.ratio-value{font-size:13px;color:var(--c-primary-dark);margin-top:1px;font-variant-numeric:tabular-nums}
.total-wrap{margin:22px 0 10px;padding:10px 22px;border-radius:12px;background:rgba(79,172,254,.12);
  display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.total{font-size:26px;font-weight:700;background:var(--grad-total);-webkit-background-clip:text;color:transparent}
.badge{font-size:20px;font-weight:700}
.update-time{font-size:14px;color:var(--c-sub);margin-bottom:14px}
.skeleton{background:var(--c-skeleton);border-radius:4px;animation:pulse 1.2s infinite ease-in-out}
@keyframes pulse{0%,100%{opacity:.4}50%{opacity:.8}}
/* === ÁßªÂä®Á´Ø‰ºòÂåñÔºà‚â§560pxÔºâ === */
@media(max-width:560px){
  .token-icon,.icon-fallback{width:26px;height:26px}
  .row{grid-template-columns:1fr;padding:12px}
  .label{margin-bottom:6px}
  .value{text-align:left;width:100%}
  .controls{flex-direction:column;align-items:flex-start}
}
</style>
</head>
<body>
<!-- ===== È°∂ÈÉ® ===== -->
<div class="topbar">
  <div class="title">
    ÊµÅÂä®ÊÄßÊ±†Â≠êÂÆûÊó∂Êï∞ÊçÆ
    <svg id="spinner" width="16" height="16" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3"
              fill="none" stroke-linecap="round"
              stroke-dasharray="60" stroke-dashoffset="48"></circle>
    </svg>
  </div>
  <div class="controls" id="portalWrap">
    <select id="poolSelect"></select>
    <label class="switch"><input type="checkbox" id="autoCb" checked>Ëá™Âä®Âà∑Êñ∞</label>
    <label class="switch" id="mergeWrap" style="display:none;"><input type="checkbox" id="mergeCb" checked>ÂêàÂπ∂ÊòæÁ§∫</label>
    <label class="switch"><input type="checkbox" id="darkModeToggle">Ê∑±Ëâ≤Ê®°Âºè</label>
    <a class="btn" href="https://x.com/0xXIAOc" target="_blank">üê¶ ‰ΩúËÄÖÊé®Áâπ</a>
  </div>
</div>

<!-- ===== ÂàóË°® / ÊÄª‰ª∑ÂÄº ===== -->
<div id="rows" class="cards"></div>
<div class="total-wrap" id="totalWrap">
  <span id="totalValue" class="total">üí∞</span>
  <span id="recommend" class="badge"></span>
</div>
<div id="updateTime" class="update-time"></div>
<button id="refreshBtn" class="btn" aria-label="Âà∑Êñ∞‰ΩôÈ¢ù">‚ü≥ Âà∑Êñ∞‰ΩôÈ¢ù</button>

<!-- ===== ‰æùËµñ ===== -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.css"/>

<!-- ========== ‰∏öÂä°ËÑöÊú¨ ========== -->
<script>
/* -------- ÊöóÈªëÊ®°Âºè -------- */
const html=document.documentElement,darkToggle=document.getElementById('darkModeToggle');
const saved=localStorage.getItem('darkMode');
const applyDark=v=>{html.classList.toggle('dark',v);localStorage.setItem('darkMode',v?'1':'0');darkToggle.checked=v};
darkToggle.onchange=()=>applyDark(darkToggle.checked);applyDark(saved==='1');

/* -------- Ê±†Â≠êÈÖçÁΩÆ -------- */
const POOLS={
  "USDT-KOGE":{
    tokens:[
      {symbol:'USDT',address:'0x55d398326f99059ff775485246999027b3197955',logo:'./usdt.png',color:'#26a17b',decimals:null},
      {symbol:'KOGE',address:'0xe6df05ce8c8301223373cf5b969afcb1498c5528',logo:'./koge.png',color:'#ff9800',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:[
      '0xcf59b8c8baa2dea520e3d549f97d4e49ade17057', /* Pancake */
      '0x81c7294b66955824bc04acb642ae8dc58e6ce507'  /* Uni ‚Äî ‰ªÖÁªüËÆ°‰ΩôÈ¢ù */
    ],
    labels:['Pancake','Uni']
  },
  "USDT-TAIKO":{
    tokens:[
      {symbol:'USDT',address:'0x55d398326f99059ff775485246999027b3197955',logo:'./usdt.png',color:'#26a17b',decimals:null},
      {symbol:'TAIKO',address:'0x30c60b20c25b2810ca524810467a0c342294fc61',logo:'./taiko.png',color:'#8e44ad',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:['0xbe77ac86750fb0359fa623e63e7f009979bb701c'],
    debank:'https://debank.com/profile/0xbe77ac86750fb0359fa623e63e7f009979bb701c'
  },
  "USDT-ZKJ":{
    tokens:[
      {symbol:'USDT',address:'0x55d398326f99059ff775485246999027b3197955',logo:'./usdt.png',color:'#26a17b',decimals:null},
      {symbol:'ZKJ',address:'0xc71b5f631354be6853efe9c3ab6b9590f8302e81',logo:'./zkj.png',color:'#1e88ff',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:['0x5968feacba91d55010975e0cfe8acfc32664ad33'],
    debank:'https://debank.com/profile/0x5968feacba91d55010975e0cfe8acfc32664ad33'
  },
  "USDC-SQD":{
    tokens:[
      {symbol:'USDC',address:'0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d',logo:'./usdc.png',color:'#2775CA',decimals:null},
      {symbol:'SQD',address:'0xe50e3d1a46070444f44df911359033f2937fcc13',logo:'./sqd.png',color:'#f06292',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:['0x43256d0dcc2571e564311edb6d7e8f076a72fc46'],
    debank:'https://debank.com/profile/0x43256d0dcc2571e564311edb6d7e8f076a72fc46'
  },
  "USDT-AB":{
    tokens:[
      {symbol:'USDT',address:'0x55d398326f99059ff775485246999027b3197955',logo:'./usdt.png',color:'#26a17b',decimals:null},
      {symbol:'AB',address:'0x95034f653d5d161890836ad2b6b8cc49d14e029a',logo:'./ab.png',color:'#ffb700',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:['0xd7af60112d7dfe0f914724e3407dd54424aaa19b'],
    debank:'https://debank.com/profile/0xd7af60112d7dfe0f914724e3407dd54424aaa19b'
  },
  "BNB-AB":{
    tokens:[
      {symbol:'BNB',address:'0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c',logo:'./bnb.png',color:'#f0b90b',decimals:null},
      {symbol:'AB',address:'0x95034f653d5d161890836ad2b6b8cc49d14e029a',logo:'./ab.png',color:'#ffb700',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:['0xb05500ea96db17d28cd0eb30bcb797708f279d36'],
    debank:'https://debank.com/profile/0xb05500ea96db17d28cd0eb30bcb797708f279d36'
  },
  "USDT-ZRC":{
    tokens:[
      {symbol:'USDT',address:'0x55d398326f99059ff775485246999027b3197955',logo:'./usdt.png',color:'#26a17b',decimals:null},
      {symbol:'ZRC',address:'0xdac991621fd8048d9f235324780abd6c3ad26421',logo:'./zrc.png',color:'#9c27b0',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:['0xe9388678f0542d5406145c3db85b5b754daff085'],
    debank:'https://debank.com/profile/0xe9388678f0542d5406145c3db85b5b754daff085'
  },
  "USDT-SERAPH":{
    tokens:[
      {symbol:'USDT',address:'0x55d398326f99059ff775485246999027b3197955',logo:'./usdt.png',color:'#26a17b',decimals:null},
      {symbol:'SERAPH',address:'0xd6b48ccf41a62eb3891e58d0f006b19b01d50cca',logo:'./seraph.png',color:'#d32f2f',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:['0xd5b642646a6e40090d5d61ca11a78ee2f6e0ef14'],
    debank:'https://debank.com/profile/0xd5b642646a6e40090d5d61ca11a78ee2f6e0ef14'
  },
  "BNB-MYX":{
    tokens:[
      {symbol:'BNB',address:'0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c',logo:'./bnb.png',color:'#f0b90b',decimals:null},
      {symbol:'MYX',address:'0xd82544bf0dfe8385ef8fa34d67e6e4940cc63e16',logo:'./myx.png',color:'#00bcd4',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:['0x6ec31af1bb9a72aacec12e4ded508861b05f4503'],
    debank:'https://debank.com/profile/0x6ec31af1bb9a72aacec12e4ded508861b05f4503'
  },
  "USDT-BR":{
    tokens:[
      {symbol:'USDT',address:'0x55d398326f99059ff775485246999027b3197955',logo:'./usdt.png',color:'#26a17b',decimals:null},
      {symbol:'BR',address:'0xff7d6a96ae471bbcd7713af9cb1feeb16cf56b41',logo:'./br.png',color:'#2196f3',decimals:null}
    ],
    rpc:'https://bsc-dataseed.binance.org/',
    addresses:['0x380aadf63d84d3a434073f1d5d95f02fb23d5228'],
    debank:'https://debank.com/profile/0x380aadf63d84d3a434073f1d5d95f02fb23d5228'
  }
};

/* -------- ËøêË°åÊó∂ DOM -------- */
const poolSelect=document.getElementById('poolSelect'),
      rowsBox=document.getElementById('rows'),
      totalDom=document.getElementById('totalValue'),
      recommendDom=document.getElementById('recommend'),
      timeDom=document.getElementById('updateTime'),
      portalWrap=document.getElementById('portalWrap'),
      spinner=document.getElementById('spinner'),
      autoCb=document.getElementById('autoCb'),
      mergeWrap=document.getElementById('mergeWrap'),
      mergeCb=document.getElementById('mergeCb'),
      refreshBtn=document.getElementById('refreshBtn');

/* -------- ÂàùÂßãÂåñ‰∏ãÊãâ -------- */
Object.keys(POOLS).forEach(n=>{
  const op=document.createElement('option');op.value=n;op.textContent=n;poolSelect.appendChild(op);
});
const allOp=document.createElement('option');allOp.value='__ALL__';allOp.textContent='ÂÖ®ÈÉ®Ê±†Â≠ê';poolSelect.appendChild(allOp);
let currentPoolName=Object.keys(POOLS)[0];poolSelect.value=currentPoolName;
let mergeMode=true;

/* -------- Provider / Multicall -------- */
const providers={};
let provider,multicall;
function initProvider(){
  const url=currentPoolName==='__ALL__'?POOLS[Object.keys(POOLS)[0]].rpc:POOLS[currentPoolName].rpc;
  provider=providers[url]??=new ethers.providers.JsonRpcProvider(url);
  multicall=new ethers.Contract(
    '0x1Ee38d535d541c55C9dae27B12edf090C608E6Fb',
    ['function aggregate(tuple(address target,bytes callData)[]) view returns(uint256,bytes[])'],
    provider
  );
}
initProvider();

/* -------- ÂÖ®Â±ÄÁºìÂ≠ò -------- */
const CFG={TIMEOUT:8000,RETRY:1,INTERVAL:60000,PRICE_CACHE:30000};
const cache={},LS='P_';
const getCached=k=>{
  if(cache[k]!=null)return cache[k];
  try{const {v,ts}=JSON.parse(localStorage.getItem(LS+k)||'{}');
      return Date.now()-ts<CFG.PRICE_CACHE?v:null}catch{return null}
};
const setCached=(k,v)=>{cache[k]=v;localStorage.setItem(LS+k,JSON.stringify({v,ts:Date.now()}))};

/* -------- ‰ª∑Ê†ºÊü•ËØ¢ -------- */
const STABLE={'0x55d398326f99059ff775485246999027b3197955':1,'0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d':1};
async function fetchJSON(u,t=CFG.TIMEOUT,r=CFG.RETRY){
  for(let i=0;i<=r;i++){
    const ctl=new AbortController(),id=setTimeout(()=>ctl.abort(),t);
    try{const res=await fetch(u,{signal:ctl.signal});clearTimeout(id);if(!res.ok)throw 0;return res.json()}
    catch{if(i===r)throw 0;await new Promise(s=>setTimeout(s,500))}
  }
}
async function getPrice(addr){
  const a=addr.toLowerCase();if(a in STABLE){setCached(a,1);return 1}
  const c=getCached(a);if(c!==null)return c;
  const pick=pairs=>pairs.find(x=>['USDT','USDC','BUSD'].includes(x.quoteToken.symbol)&&x.liquidity.usd>5000);
  const p1=()=>fetchJSON(`https://api.dexscreener.com/latest/dex/tokens/${a}`).then(j=>{const p=pick(j.pairs||[]);if(!p)throw 0;return +p.priceUsd});
  const p2=()=>fetchJSON(`https://api.dexscreener.com/latest/dex/search/?q=${a}`).then(j=>{const p=pick(j.pairs||[]);if(!p)throw 0;return +p.priceUsd});
  const price=await Promise.any([p1(),p2()]);setCached(a,price);return price;
}

/* -------- balance & decimals -------- */
const ERC20=['function decimals() view returns(uint8)','function balanceOf(address) view returns(uint256)'];
const iface=new ethers.utils.Interface(ERC20);
async function ensureDecimals(t){
  if(t.decimals!=null)return;
  const k='dec_'+t.address.toLowerCase();let d=getCached(k);
  if(d!=null){t.decimals=d;return}
  try{d=await new ethers.Contract(t.address,ERC20,provider).decimals()}catch{d=18}
  t.decimals=d;setCached(k,d);
}
async function getBalances(tokens,addrs){
  const all=await Promise.all(addrs.map(a=>{
    const calls=tokens.map(t=>[t.address,iface.encodeFunctionData('balanceOf',[a])]);
    return multicall.aggregate(calls).then(r=>r[1].map(x=>ethers.BigNumber.from(x)))
  }));
  return tokens.map((_,i)=>all.reduce((s,r)=>s.add(r[i]),ethers.BigNumber.from(0)));
}

/* -------- UI ËæÖÂä© -------- */
const fmtQty=n=>n>=1?n.toLocaleString(undefined,{maximumFractionDigits:2}):n.toFixed(4);
const fmtM=n=>(n/1e6).toLocaleString(undefined,{maximumFractionDigits:1});
function recommend(total,minR){
  if(minR<5)      return{txt:'‚ö†Ô∏è Ë∞®ÊÖé',col:'#f59e0b'};
  if(total<1.5e6) return{txt:'üö´ ‰∏çÊé®Ëçê',col:'#e11d48'};
  if(total<3e6)   return{txt:'‚ö†Ô∏è Ë∞®ÊÖé',col:'#f59e0b'};
  return{txt:'‚úÖ Êé®ËçêÂà∑',col:'#10b981'}
}
function skeleton(tokens){
  rowsBox.innerHTML='';
  tokens.forEach(t=>{
    const d=document.createElement('div');d.className='row';d.style.setProperty('--stripe',t.color||'#ccc');
    d.innerHTML=`<div class="label"><img class="token-icon" src="${t.logo||''}">${t.symbol}</div>
                 <div class="value"><div class="skeleton" style="width:120px;height:20px;margin-bottom:6px"></div>
                 <div class="skeleton" style="width:100px;height:18px;margin-bottom:6px"></div>
                 <div class="skeleton" style="width:60px;height:16px"></div></div>`;
    rowsBox.appendChild(d);
  });
  totalDom.textContent='üí∞';recommendDom.textContent='';timeDom.textContent='';
}

/* -------- Ê∏≤ÊüìÂçïÊ±† -------- */
async function renderSingle(){
  const p=POOLS[currentPoolName];skeleton(p.tokens);
  try{
    await Promise.all(p.tokens.map(ensureDecimals));
    const [prices,bals]=await Promise.all([
      Promise.all(p.tokens.map(t=>getPrice(t.address))),
      getBalances(p.tokens,p.addresses)
    ]);
    const qty=p.tokens.map((t,i)=>parseFloat(ethers.utils.formatUnits(bals[i],t.decimals)));
    const usd=qty.map((q,i)=>Math.round(q*prices[i]));
    const total=usd.reduce((a,b)=>a+b,0);
    rowsBox.innerHTML='';
    p.tokens.forEach((t,i)=>{
      const row=document.createElement('div');row.className='row';row.style.setProperty('--stripe',t.color);
      row.innerHTML=`<div class="label"><img class="token-icon" src="${t.logo}" onerror="this.style.display='none'">${t.symbol}</div>
                     <div class="value"><span class="amount-label">Êï∞Èáè</span><span class="value-num">${fmtQty(qty[i])}</span>
                     <span class="price-label">‰ª∑ÂÄº</span><span class="value-price">‚âà $${usd[i].toLocaleString()}</span>
                     <span class="ratio-label">ÊØî‰æã</span><span class="ratio-value">${((usd[i]/total)*100).toFixed(1)}%</span></div>`;
      rowsBox.appendChild(row);
    });
    const rec=recommend(total,Math.min(...usd.map(u=>u/total*100)));
    totalDom.textContent=`üí∞ ÊÄª‰ª∑ÂÄºÔºö$${total.toLocaleString()}`;recommendDom.textContent=rec.txt;recommendDom.style.color=rec.col;
    timeDom.textContent='‰∏äÊ¨°Êõ¥Êñ∞Ôºö'+new Date().toLocaleTimeString();
  }catch{Toastify({text:'‚ùå Êï∞ÊçÆËé∑ÂèñÂ§±Ë¥•',duration:3500,gravity:'top',style:{background:'#e11d48'}}).showToast()}
}

/* -------- Ê∏≤Êüì ALL -------- */
async function renderAll(){
  skeleton([{symbol:'Âä†ËΩΩ'}]);
  try{
    const list=[];
    for(const name in POOLS){
      const p=POOLS[name];
      await Promise.all(p.tokens.map(ensureDecimals));
      const [prices,bals]=await Promise.all([
        Promise.all(p.tokens.map(t=>getPrice(t.address))),
        getBalances(p.tokens,p.addresses)
      ]);
      const total=p.tokens.reduce((s,t,i)=>s+parseFloat(ethers.utils.formatUnits(bals[i],t.decimals))*prices[i],0);
      const minR=Math.min(...p.tokens.map((t,i)=>parseFloat(ethers.utils.formatUnits(bals[i],t.decimals))*prices[i]/total*100));
      list.push({name,tokens:p.tokens,total:Math.round(total),minR});
    }
    rowsBox.innerHTML='';
    list.forEach(o=>{
      const rec=recommend(o.total,o.minR);
      const row=document.createElement('div');row.className='row';row.style.setProperty('--stripe',o.tokens[0].color);
      row.innerHTML=`<div class="label"><img class="token-icon" src="${o.tokens[0].logo}"><img class="token-icon" src="${o.tokens[1].logo}"> ${o.name}
                     <span style="margin-left:6px;color:${rec.col}">${rec.txt}</span></div>
                     <div class="value"><span class="price-label">‰ª∑ÂÄº</span>
                     <span class="value-price">‚âà $${fmtM(o.total)}M</span></div>`;
      rowsBox.appendChild(row);
    });
    totalDom.textContent='üí∞';recommendDom.textContent='';timeDom.textContent='‰∏äÊ¨°Êõ¥Êñ∞Ôºö'+new Date().toLocaleTimeString();
  }catch{Toastify({text:'‚ùå Êï∞ÊçÆËé∑ÂèñÂ§±Ë¥•',duration:3500,gravity:'top',style:{background:'#e11d48'}}).showToast()}
}

/* -------- ‰º†ÈÄÅÈó®ÊåâÈíÆ -------- */
function updatePortal(){
  document.querySelectorAll('.debank-btn').forEach(x=>x.remove());
  if(currentPoolName==='__ALL__')return;
  const p=POOLS[currentPoolName];
  if(currentPoolName==='USDT-KOGE'){  // ‰ªÖ Pancake
    const btn=document.createElement('a');btn.className='btn debank-btn';btn.target='_blank';
    btn.href='https://debank.com/profile/'+p.addresses[0];
    btn.innerHTML='<img src="./pancake.png" class="btn-icon">Pancake Ê±†Â≠ê‰ΩôÈ¢ù‰º†ÈÄÅÈó®';
    portalWrap.insertBefore(btn,portalWrap.lastElementChild);
  }else if(p.debank){
    const btn=document.createElement('a');btn.className='btn debank-btn';btn.target='_blank';btn.href=p.debank;
    btn.innerHTML='<img src="./pancake.png" class="btn-icon">Ê±†Â≠ê‰ΩôÈ¢ù‰º†ÈÄÅÈó®';
    portalWrap.insertBefore(btn,portalWrap.lastElementChild);
  }
}

/* -------- Âà∑Êñ∞ÈÄªËæë -------- */
let loading=false;
async function refresh(){
  if(loading)return;loading=true;spinner.classList.add('spin');refreshBtn.disabled=true;refreshBtn.textContent='Âà∑Êñ∞‰∏≠‚Ä¶';
  currentPoolName==='__ALL__'?await renderAll():await renderSingle();
  spinner.classList.remove('spin');refreshBtn.disabled=false;refreshBtn.textContent='‚ü≥ Âà∑Êñ∞‰ΩôÈ¢ù';loading=false;
}

/* -------- ‰∫ã‰ª∂ÁªëÂÆö -------- */
poolSelect.onchange=()=>{currentPoolName=poolSelect.value;initProvider();updatePortal();refresh()};
mergeCb.onchange=()=>{mergeMode=mergeCb.checked;refresh()};
refreshBtn.onclick=refresh;
let timer=setInterval(refresh,CFG.INTERVAL);
autoCb.onchange=()=>{autoCb.checked?timer=setInterval(refresh,CFG.INTERVAL):clearInterval(timer)};
document.addEventListener('visibilitychange',()=>{if(document.hidden)clearInterval(timer);else if(autoCb.checked){refresh();timer=setInterval(refresh,CFG.INTERVAL)}});

/* -------- ÂàùÂßãËøêË°å -------- */
updatePortal();refresh();
</script>
</body>
</html>
